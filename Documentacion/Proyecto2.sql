CREATE TABLE PADRE(
Correo varchar2(100) NOT NULL,
Pasword varchar2(16) NOT NULL,
Nombre varchar2(50) NOT NULL,
Telefono NUMBER NOT NULL,
Dinero NUMBER NOT NULL ,
CONSTRAINT Correo_PK PRIMARY KEY(Correo)
);

COMMIT;

CREATE TABLE DIRECCION(
ID_Direccion NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
Departamento varchar2(100) NOT NULL ,
Municipio varchar2(100) NOT NULL ,
Descripcion varchar2(100) NOT NULL ,
Latitud NUMBER NOT NULL,
Longitud NUMBER NOT NULL,
Padre_FK varchar2(100) NOT NULL,
CONSTRAINT ID_Direcion_PK PRIMARY key(ID_Direccion),
FOREIGN KEY (Padre_FK) REFERENCES PADRE(Correo)ON DELETE CASCADE
);

COMMIT;

CREATE TABLE HIJO(
Nickname varchar2(50) NOT NULL,
Nombre varchar2(50) NOT NULL,
Sexo varchar2(10) NOT NULL,
Fecha_Nacimiento varchar2(11) NOT NULL,
Edad NUMBER NOT NULL,
Pasword varchar2(16) NOT NULL,
Cantidad_Bastones NUMBER,
Padre_FK varchar2(100) NOT NULL,
CONSTRAINT Nickname_PK PRIMARY KEY(Nickname),
FOREIGN KEY (Padre_FK) REFERENCES PADRE(Correo)ON DELETE CASCADE
);

COMMIT;

CREATE TABLE ADMIN(
Usuario varchar2(25) NOT NULL,
Pasword varchar2(16) NOT NULL,
CONSTRAINT Usuario_PK PRIMARY KEY(Usuario)
);

COMMIT;

CREATE TABLE SANTA(
Usuario varchar2(25) NOT NULL,
Pasword varchar2(16) NOT NULL,
CONSTRAINT Santa_PK PRIMARY KEY(Usuario)
);

COMMIT;

CREATE TABLE BUENA_ACCION(
ID_BuenaAccion NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
Titulo varchar2(50) NOT NULL ,
Descripcion varchar2(250) NOT NULL,
Recompensa NUMBER NOT NULL ,
Edad NUMBER NOT NULL,
CONSTRAINT ID_BuenaAccion_PK PRIMARY KEY(ID_BuenaAccion)
);

COMMIT;

CREATE TABLE BUENA_ACCION_REALIZADA(
ID_Realizada NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
ID_BuenaAccion_FK NUMBER NOT NULL ,
Hijo_FK varchar2(50) NOT NULL ,
Padre_FK varchar2(100) NOT NULL,
Estado varchar2(10) NOT NULL,
Recompensa NUMBER NOT NULL ,
CONSTRAINT ID_Realizada_PK PRIMARY KEY (ID_Realizada),
FOREIGN KEY (ID_BuenaAccion_FK) REFERENCES BUENA_ACCION(ID_BuenaAccion)ON DELETE CASCADE,
FOREIGN KEY (Hijo_FK) REFERENCES HIJO(Nickname)ON DELETE CASCADE,
FOREIGN KEY (Padre_FK) REFERENCES PADRE(Correo)ON DELETE CASCADE
);

COMMIT;

CREATE TABLE JUGUETE(
ID_Juguete NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
Nombre varchar2(50) NOT NULL ,
Categoria varchar2(50) NOT NULL ,
Precio NUMBER NOT NULL ,
Imagen BLOB ,
Edad number(9) NOT NULL ,
CONSTRAINT ID_Juguete_PK PRIMARY KEY (ID_Juguete)
);

COMMIT;

CREATE TABLE CARTA(
ID_Carta NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
Hijo_FK varchar2(50) NOT NULL ,
Padre_FK varchar2(100) NOT NULL,
Direccion_FK NUMBER NOT NULL,
Descripcion varchar2(250) NOT NULL,
Estado varchar2(10) NOT NULL ,
Precio_Total NUMBER NOT NULL ,
Fecha_Envio timestamp default current_timestamp,
CONSTRAINT ID_Carta_PK PRIMARY KEY(ID_Carta),
FOREIGN KEY (Hijo_FK) REFERENCES HIJO(Nickname)ON DELETE CASCADE,
FOREIGN KEY (Padre_FK) REFERENCES PADRE(Correo)ON DELETE CASCADE,
FOREIGN KEY (Direccion_FK) REFERENCES DIRECCION(ID_Direccion)ON DELETE CASCADE
);
COMMIT;

CREATE TABLE JUGUETE_CARTA(
ID_JugueteCarta NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
Juguete_FK NUMBER NOT NULL ,
Carta_FK NUMBER NOT NULL ,
Cantidad NUMBER NOT NULL ,
Total NUMBER NOT NULL ,
CONSTRAINT ID_JugueteCarta_PK PRIMARY KEY (ID_JugueteCarta),
FOREIGN KEY (Juguete_FK) REFERENCES JUGUETE(ID_Juguete)ON DELETE CASCADE,
FOREIGN KEY (Carta_FK) REFERENCES CARTA(ID_Carta)ON DELETE CASCADE
);

COMMIT;

CREATE TABLE CONVERSACION(
ID_Conversacion NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
Admin_FK varchar2(50) NOT NULL ,
HiJo_FK varchar2(50) NOT NULL ,
CONSTRAINT ID_Conversacion_PK PRIMARY KEY (ID_Conversacion),
FOREIGN KEY (Admin_FK) REFERENCES ADMIN(Usuario)ON DELETE CASCADE,
FOREIGN KEY (Hijo_FK) REFERENCES HIJO(Nickname)ON DELETE CASCADE
);

COMMIT;

CREATE TABLE MENSAJE(
ID_Mensaje NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
Descripcion varchar2(250) NOT NULL,
Emisor varchar2(50) NOT NULL ,
Conversacion_FK NUMBER NOT NULL,
CONSTRAINT ID_Mensaje_PK PRIMARY KEY (ID_Mensaje),
FOREIGN KEY (Conversacion_FK) REFERENCES CONVERSACION(ID_Conversacion)ON DELETE CASCADE
);

COMMIT;

CREATE TABLE PUBLICACION(
ID_Publicacion NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
Publicacion varchar2(250) NOT NULL,
Imagen BLOB ,
Santa_FK varchar2(50) NOT NULL ,
CONSTRAINT ID_Publicacion_PK PRIMARY KEY (ID_Publicacion),
FOREIGN KEY (Santa_FK) REFERENCES SANTA(Usuario)ON DELETE CASCADE
);

COMMIT;

CREATE TABLE COMENTARIO(
ID_Comentario NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
Hijo_FK varchar2(50) NOT NULL ,
Comentario varchar2(250) NOT NULL ,
Publicacion_FK NUMBER NOT NULL,
CONSTRAINT ID_Comentario_PK PRIMARY KEY (ID_Comentario),
FOREIGN KEY (Hijo_FK) REFERENCES HIJO(Nickname)ON DELETE CASCADE,
FOREIGN KEY (Publicacion_FK) REFERENCES PUBLICACION(ID_Publicacion)ON DELETE CASCADE
);

COMMIT;

INSERT INTO SANTA VALUES('SantaClaus','santaUser1');

INSERT INTO BUENA_ACCION VALUES(NULL, 'Limpiar Habitacion', 'Hacer la limpieza de su propia habitacion', 50, 6);
INSERT INTO BUENA_ACCION VALUES(NULL, 'Pintar Casa', 'Pintar el frente de la casa', 200, 10);
INSERT INTO ADMIN VALUES('Osman Perez','201801229');
INSERT INTO PUBLICACION VALUES (NULL, 'Feliz Navidad a todos', NULL, 'SantaClaus');
INSERT INTO JUGUETE VALUES(NULL,'Bicicleta','Transporte', 250,NULL,6);
INSERT INTO JUGUETE VALUES(NULL,'Patineta','Transporte', 100,NULL,10);
INSERT INTO JUGUETE VALUES(NULL,'Oso','Peluche', 50,NULL,6);
INSERT INTO JUGUETE VALUES(NULL,'Patines','Transporte', 100,NULL,6);
INSERT INTO JUGUETE VALUES(NULL, 'Silbato','Sonido',10,NULL,6);
SELECT * FROM BUENA_ACCION ba , BUENA_ACCION_REALIZADA bar  WHERE ba.ID_BUENAACCION = bar.ID_BUENAACCION_FK ;
SELECT * FROM BUENA_ACCION_REALIZADA bar ;

SELECT * FROM CARTA ORDER BY ID_CARTA DESC; 
SELECT * FROM JUGUETE_CARTA jc ;
SELECT * FROM ADMIN;
SELECT * FROM PUBLICACION;
SELECT * FROM JUGUETE j ;
SELECT * FROM CONVERSACION c ;
SELECT * FROM DIRECCION d2 ;
SELECT * FROM HIJO;
SELECT * FROM PADRE;
SELECT * FROM SANTA;
COMMIT;

SELECT jc.JUGUETE_FK , j.NOMBRE ,SUM(jc.CANTIDAD) AS CantidadTotal FROM JUGUETE_CARTA jc INNER JOIN JUGUETE j ON jc.JUGUETE_FK = j.ID_JUGUETE GROUP BY jc.JUGUETE_FK, j.NOMBRE ORDER BY CantidadTotal DESC FETCH NEXT 10 ROWS ONLY;
SELECT d.DEPARTAMENTO , COUNT(d.DEPARTAMENTO) AS CantidadCompras FROM CARTA c , DIRECCION d WHERE c.DIRECCION_FK = d.ID_DIRECCION  GROUP BY d.DEPARTAMENTO ORDER BY CantidadCompras DESC FETCH NEXT 10 ROWS ONLY;
SELECT d.MUNICIPIO , COUNT(d.MUNICIPIO) AS CantidadCompras FROM CARTA c , DIRECCION d WHERE c.DIRECCION_FK = d.ID_DIRECCION  GROUP BY d.MUNICIPIO ORDER BY CantidadCompras DESC FETCH NEXT 10 ROWS ONLY;
SELECT bar.ID_BUENAACCION_FK , ba.TITULO, COUNT(bar.ID_BUENAACCION_FK) AS CantidadRealizada FROM BUENA_ACCION_REALIZADA bar  INNER JOIN BUENA_ACCION ba ON ba.ID_BUENAACCION = bar.ID_BUENAACCION_FK GROUP BY bar.ID_BUENAACCION_FK , ba.TITULO ORDER BY CantidadRealizada DESC FETCH NEXT 5 ROWS ONLY; 
SELECT c.*, p2.PUBLICACION , p2.ID_Publicacion FROM COMENTARIO c , PUBLICACION p2 WHERE c.PUBLICACION_FK = p2.ID_PUBLICACION AND c.HIJO_FK = 'Super Oscar 10' ORDER BY c.ID_COMENTARIO ASC;
SELECT j.CATEGORIA , COUNT(j.CATEGORIA) AS CantidadCompras FROM JUGUETE j , JUGUETE_CARTA jc WHERE j.ID_JUGUETE = jc.JUGUETE_FK GROUP BY j.CATEGORIA ORDER BY CantidadCompras DESC FETCH NEXT 5 ROWS ONLY;
SELECT * FROM CARTA c ORDER BY c.PRECIO_TOTAL DESC;

/*DROP TABLE JUGUETE_CARTA ;
DROP TABLE COMENTARIO ;
DROP TABLE MENSAJE ;
DROP TABLE PUBLICACION ;
DROP TABLE CONVERSACION ;
DROP TABLE BUENA_ACCION_REALIZADA ;
DROP TABLE BUENA_ACCION ;
DROP TABLE JUGUETE ;
DROP TABLE SANTA ;
DELETE FROM ADMIN a ;
DROP TABLE ADMIN;
DROP TABLE CARTA ;
DROP TABLE HIJO;
DROP TABLE DIRECCION ;
DROP TABLE PADRE ;/*/

